--  criação da tabela transacao

CREATE TABLE public.transacao (
	id_transacao int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	id_usuario int8 NOT NULL,
	id_livro int8 NOT NULL,
	tipo varchar(20) NOT NULL,
	data_hora timestamp(6) NOT NULL,
	url_visualizacao varchar(1000) NULL,
	url_download varchar(1000) NULL,
	valor numeric(38, 2) NULL,
	CONSTRAINT transacao_pkey PRIMARY KEY (id_transacao),
	CONSTRAINT transacao_tipo_check CHECK (((tipo)::text = ANY ((ARRAY['ACESSO'::character varying, 'DOWNLOAD'::character varying])::text[])))
);

-- criação de indices

CREATE INDEX idx4tt23lmkcsygxx9krvh6x19si ON public.transacao USING btree (id_usuario);
CREATE INDEX idx77t49mwxvt1klmxpcmx1cn0g1 ON public.transacao USING btree (id_livro);
CREATE INDEX idx96hty4ppi6ks8h3kfdhti166w ON public.transacao USING btree (tipo);
CREATE INDEX idxfembbpdr99pviy2c0xwa7cxkc ON public.transacao USING btree (data_hora);

-- criação de chaves estrangeiras

ALTER TABLE public.transacao ADD CONSTRAINT fk7wi47a7k138iu27ktjbygowxx FOREIGN KEY (id_usuario) REFERENCES public.usuario(id_usuario);
ALTER TABLE public.transacao ADD CONSTRAINT fkjevpu07vxh1v0m300y76f1exu FOREIGN KEY (id_livro) REFERENCES public.livro(id_livro);

-- inserção de dados

INSERT INTO Transacao (tipo, data_hora, url_download, url_visualizacao, valor, id_usuario, id_livro) VALUES
('ACESSO', '2025-03-16 11:27:53', NULL, 'http://visualizar.livros.vc/ebook-44', 0.00, 1, 44),
('ACESSO', '2025-06-14 14:10:09', NULL, 'http://visualizar.livros.vc/ebook-14', 0.00, 5, 14),
('ACESSO', '2025-05-04 10:36:29', NULL, 'http://visualizar.livros.vc/ebook-20', 0.00, 5, 20),
('ACESSO', '2025-09-01 06:15:14', NULL, 'http://visualizar.livros.vc/ebook-11', 0.00, 4, 11),
('ACESSO', '2025-10-01 10:15:15', NULL, 'http://visualizar.livros.vc/ebook-30', 0.00, 5, 30),
('ACESSO', '2025-02-23 08:28:20', NULL, 'http://visualizar.livros.vc/ebook-3', 0.00, 1, 3),
('DOWNLOAD', '2025-07-11 19:20:02', 'http://download.livros.vc/ebook-48.pdf', NULL, 45.00, 3, 48),
('ACESSO', '2025-05-27 20:12:24', NULL, 'http://visualizar.livros.vc/ebook-33', 0.00, 3, 33),
('ACESSO', '2025-03-22 11:21:55', NULL, 'http://visualizar.livros.vc/ebook-2', 0.00, 3, 2),
('ACESSO', '2025-10-24 18:31:06', NULL, 'http://visualizar.livros.vc/ebook-34', 0.00, 3, 34),
('ACESSO', '2025-07-28 17:58:05', NULL, 'http://visualizar.livros.vc/ebook-19', 0.00, 1, 19),
('ACESSO', '2025-01-19 20:53:05', NULL, 'http://visualizar.livros.vc/ebook-20', 0.00, 3, 20),
('ACESSO', '2025-07-05 16:21:01', NULL, 'http://visualizar.livros.vc/ebook-9', 0.00, 2, 9),
('ACESSO', '2025-10-31 17:41:30', NULL, 'http://visualizar.livros.vc/ebook-47', 0.00, 2, 47),
('DOWNLOAD', '2025-02-17 16:01:58', 'http://download.livros.vc/ebook-30.pdf', NULL, 60.00, 4, 30),
('ACESSO', '2025-07-06 18:49:20', NULL, 'http://visualizar.livros.vc/ebook-41', 0.00, 2, 41),
('DOWNLOAD', '2025-10-20 00:15:37', 'http://download.livros.vc/ebook-15.pdf', NULL, 50.00, 4, 15),
('ACESSO', '2025-01-13 08:34:28', NULL, 'http://visualizar.livros.vc/ebook-45', 0.00, 5, 45),
('ACESSO', '2025-09-08 19:22:47', NULL, 'http://visualizar.livros.vc/ebook-32', 0.00, 1, 32),
('ACESSO', '2025-07-29 11:28:16', NULL, 'http://visualizar.livros.vc/ebook-5', 0.00, 5, 5),
('ACESSO', '2025-02-14 15:34:05', NULL, 'http://visualizar.livros.vc/ebook-11', 0.00, 5, 11),
('ACESSO', '2025-07-25 11:34:14', NULL, 'http://visualizar.livros.vc/ebook-31', 0.00, 3, 31),
('ACESSO', '2025-03-11 01:20:04', NULL, 'http://visualizar.livros.vc/ebook-4', 0.00, 1, 4),
('ACESSO', '2025-10-28 01:31:01', NULL, 'http://visualizar.livros.vc/ebook-39', 0.00, 1, 39),
('DOWNLOAD', '2025-03-09 11:25:39', 'http://download.livros.vc/ebook-40.pdf', NULL, 18.90, 4, 40),
('ACESSO', '2025-02-27 19:10:13', NULL, 'http://visualizar.livros.vc/ebook-47', 0.00, 1, 47),
('DOWNLOAD', '2025-09-26 07:36:02', 'http://download.livros.vc/ebook-24.pdf', NULL, 40.00, 5, 24),
('DOWNLOAD', '2025-04-24 09:10:18', 'http://download.livros.vc/ebook-39.pdf', NULL, 40.00, 5, 39),
('ACESSO', '2025-01-19 17:22:10', NULL, 'http://visualizar.livros.vc/ebook-45', 0.00, 4, 45),
('ACESSO', '2025-05-26 09:28:02', NULL, 'http://visualizar.livros.vc/ebook-3', 0.00, 1, 3),
('DOWNLOAD', '2025-07-07 08:17:57', 'http://download.livros.vc/ebook-6.pdf', NULL, 35.00, 5, 6),
('ACESSO', '2025-03-11 00:28:43', NULL, 'http://visualizar.livros.vc/ebook-42', 0.00, 3, 42),
('DOWNLOAD', '2025-09-15 18:10:05', 'http://download.livros.vc/ebook-3.pdf', NULL, 40.00, 5, 3),
('ACESSO', '2025-03-19 21:11:58', NULL, 'http://visualizar.livros.vc/ebook-28', 0.00, 4, 28),
('DOWNLOAD', '2025-10-18 08:46:48', 'http://download.livros.vc/ebook-6.pdf', NULL, 35.00, 2, 6),
('DOWNLOAD', '2025-04-26 01:24:07', 'http://download.livros.vc/ebook-50.pdf', NULL, 35.00, 1, 50),
('ACESSO', '2025-11-03 01:26:08', NULL, 'http://visualizar.livros.vc/ebook-43', 0.00, 3, 43),
('ACESSO', '2025-02-13 19:06:58', NULL, 'http://visualizar.livros.vc/ebook-27', 0.00, 3, 27),
('DOWNLOAD', '2025-05-13 13:54:21', 'http://download.livros.vc/ebook-32.pdf', NULL, 30.00, 1, 32),
('ACESSO', '2025-04-04 20:36:23', NULL, 'http://visualizar.livros.vc/ebook-8', 0.00, 1, 8),
('ACESSO', '2025-05-08 15:29:44', NULL, 'http://visualizar.livros.vc/ebook-39', 0.00, 4, 39),
('ACESSO', '2025-05-04 20:35:23', NULL, 'http://visualizar.livros.vc/ebook-48', 0.00, 3, 48),
('DOWNLOAD', '2025-02-08 07:25:08', 'http://download.livros.vc/ebook-37.pdf', NULL, 65.50, 2, 37),
('ACESSO', '2025-01-16 07:21:59', NULL, 'http://visualizar.livros.vc/ebook-24', 0.00, 1, 24),
('DOWNLOAD', '2025-09-15 13:59:04', 'http://download.livros.vc/ebook-13.pdf', NULL, 30.00, 2, 13),
('DOWNLOAD', '2025-03-07 10:25:01', 'http://download.livros.vc/ebook-34.pdf', NULL, 18.90, 1, 34),
('DOWNLOAD', '2025-09-06 22:19:12', 'http://download.livros.vc/ebook-27.pdf', NULL, 60.00, 4, 27),
('ACESSO', '2025-08-19 00:20:06', NULL, 'http://visualizar.livros.vc/ebook-2', 0.00, 5, 2),
('DOWNLOAD', '2025-08-12 22:51:25', 'http://download.livros.vc/ebook-7.pdf', NULL, 25.00, 1, 7),
('DOWNLOAD', '2025-10-03 12:23:33', 'http://download.livros.vc/ebook-38.pdf', NULL, 55.00, 1, 38),
('DOWNLOAD', '2025-01-13 23:49:45', 'http://download.livros.vc/ebook-1.pdf', NULL, 55.00, 5, 1),
('ACESSO', '2025-07-14 05:06:04', NULL, 'http://visualizar.livros.vc/ebook-30', 0.00, 1, 30),
('ACESSO', '2025-05-21 20:43:05', NULL, 'http://visualizar.livros.vc/ebook-17', 0.00, 2, 17),
('ACESSO', '2025-09-19 18:20:43', NULL, 'http://visualizar.livros.vc/ebook-42', 0.00, 1, 42),
('DOWNLOAD', '2025-05-20 22:07:04', 'http://download.livros.vc/ebook-19.pdf', NULL, 40.00, 3, 19),
('DOWNLOAD', '2025-02-22 12:07:53', 'http://download.livros.vc/ebook-10.pdf', NULL, 60.00, 5, 10),
('ACESSO', '2025-04-27 15:39:46', NULL, 'http://visualizar.livros.vc/ebook-2', 0.00, 4, 2),
('ACESSO', '2025-05-13 22:02:36', NULL, 'http://visualizar.livros.vc/ebook-39', 0.00, 5, 39),
('DOWNLOAD', '2025-05-08 13:21:22', 'http://download.livros.vc/ebook-35.pdf', NULL, 45.00, 5, 35),
('ACESSO', '2025-06-04 18:05:35', NULL, 'http://visualizar.livros.vc/ebook-42', 0.00, 3, 42),
('ACESSO', '2025-01-10 08:27:58', NULL, 'http://visualizar.livros.vc/ebook-36', 0.00, 2, 36),
('ACESSO', '2025-10-21 03:42:16', NULL, 'http://visualizar.livros.vc/ebook-12', 0.00, 4, 12),
('ACESSO', '2025-03-16 12:46:19', NULL, 'http://visualizar.livros.vc/ebook-34', 0.00, 2, 34),
('DOWNLOAD', '2025-03-10 05:02:00', 'http://download.livros.vc/ebook-29.pdf', NULL, 40.00, 5, 29),
('DOWNLOAD', '2025-07-07 02:34:21', 'http://download.livros.vc/ebook-6.pdf', NULL, 35.00, 1, 6),
('DOWNLOAD', '2025-05-26 17:15:41', 'http://download.livros.vc/ebook-3.pdf', NULL, 40.00, 4, 3),
('ACESSO', '2025-02-07 17:11:20', NULL, 'http://visualizar.livros.vc/ebook-20', 0.00, 1, 20),
('ACESSO', '2025-07-26 11:50:24', NULL, 'http://visualizar.livros.vc/ebook-47', 0.00, 3, 47),
('DOWNLOAD', '2025-04-14 15:29:30', 'http://download.livros.vc/ebook-14.pdf', NULL, 65.50, 3, 14),
('ACESSO', '2025-04-16 11:19:08', NULL, 'http://visualizar.livros.vc/ebook-5', 0.00, 5, 5),
('ACESSO', '2025-02-14 05:37:48', NULL, 'http://visualizar.livros.vc/ebook-43', 0.00, 2, 43),
('ACESSO', '2025-02-26 02:11:53', NULL, 'http://visualizar.livros.vc/ebook-44', 0.00, 2, 44),
('ACESSO', '2025-04-11 22:08:05', NULL, 'http://visualizar.livros.vc/ebook-5', 0.00, 5, 5),
('ACESSO', '2025-07-17 10:08:24', NULL, 'http://visualizar.livros.vc/ebook-33', 0.00, 3, 33),
('ACESSO', '2025-07-15 16:47:16', NULL, 'http://visualizar.livros.vc/ebook-44', 0.00, 5, 44),
('DOWNLOAD', '2025-09-21 18:06:40', 'http://download.livros.vc/ebook-39.pdf', NULL, 40.00, 2, 39),
('DOWNLOAD', '2025-04-12 08:42:38', 'http://download.livros.vc/ebook-13.pdf', NULL, 30.00, 2, 13),
('ACESSO', '2025-06-04 20:20:41', NULL, 'http://visualizar.livros.vc/ebook-2', 0.00, 5, 2),
('DOWNLOAD', '2025-04-28 10:05:07', 'http://download.livros.vc/ebook-48.pdf', NULL, 45.00, 2, 48),
('ACESSO', '2025-02-25 10:33:04', NULL, 'http://visualizar.livros.vc/ebook-1', 0.00, 2, 1),
('ACESSO', '2025-06-05 19:59:52', NULL, 'http://visualizar.livros.vc/ebook-46', 0.00, 4, 46),
('ACESSO', '2025-09-20 13:18:43', NULL, 'http://visualizar.livros.vc/ebook-50', 0.00, 5, 50),
('ACESSO', '2025-01-29 15:32:17', NULL, 'http://visualizar.livros.vc/ebook-50', 0.00, 1, 50),
('DOWNLOAD', '2025-01-13 13:30:14', 'http://download.livros.vc/ebook-20.pdf', NULL, 35.00, 1, 20),
('ACESSO', '2025-06-30 03:20:57', NULL, 'http://visualizar.livros.vc/ebook-31', 0.00, 3, 31),
('DOWNLOAD', '2025-07-23 04:18:18', 'http://download.livros.vc/ebook-46.pdf', NULL, 35.00, 5, 46),
('ACESSO', '2025-09-09 00:42:44', NULL, 'http://visualizar.livros.vc/ebook-10', 0.00, 5, 10),
('DOWNLOAD', '2025-07-01 22:26:51', 'http://download.livros.vc/ebook-45.pdf', NULL, 30.00, 2, 45),
('ACESSO', '2025-03-31 00:13:23', NULL, 'http://visualizar.livros.vc/ebook-5', 0.00, 2, 5),
('DOWNLOAD', '2025-08-19 15:54:30', 'http://download.livros.vc/ebook-32.pdf', NULL, 30.00, 4, 32),
('ACESSO', '2025-05-20 05:01:34', NULL, 'http://visualizar.livros.vc/ebook-31', 0.00, 4, 31),
('DOWNLOAD', '2025-09-11 16:43:23', 'http://download.livros.vc/ebook-7.pdf', NULL, 25.00, 3, 7),
('ACESSO', '2025-06-02 12:43:12', NULL, 'http://visualizar.livros.vc/ebook-7', 0.00, 4, 7),
('ACESSO', '2025-09-08 03:17:08', NULL, 'http://visualizar.livros.vc/ebook-32', 0.00, 1, 32),
('ACESSO', '2025-06-14 09:54:41', NULL, 'http://visualizar.livros.vc/ebook-13', 0.00, 3, 13),
('ACESSO', '2025-07-08 11:50:38', NULL, 'http://visualizar.livros.vc/ebook-48', 0.00, 4, 48),
('ACESSO', '2025-04-04 15:54:37', NULL, 'http://visualizar.livros.vc/ebook-25', 0.00, 1, 25),
('ACESSO', '2025-04-17 07:18:22', NULL, 'http://visualizar.livros.vc/ebook-37', 0.00, 2, 37),
('ACESSO', '2025-05-11 18:42:40', NULL, 'http://visualizar.livros.vc/ebook-43', 0.00, 1, 43),
('ACESSO', '2025-08-11 00:45:09', NULL, 'http://visualizar.livros.vc/ebook-19', 0.00, 2, 19),
('ACESSO', '2025-07-21 17:31:00', NULL, 'http://visualizar.livros.vc/ebook-38', 0.00, 5, 38),
('ACESSO', '2025-05-11 08:31:27', NULL, 'http://visualizar.livros.vc/ebook-4', 0.00, 5, 4),
('ACESSO', '2025-05-28 17:15:23', NULL, 'http://visualizar.livros.vc/ebook-35', 0.00, 4, 35),
('ACESSO', '2025-08-11 04:09:44', NULL, 'http://visualizar.livros.vc/ebook-37', 0.00, 5, 37),
('ACESSO', '2025-09-24 18:31:39', NULL, 'http://visualizar.livros.vc/ebook-47', 0.00, 4, 47),
('ACESSO', '2025-02-18 20:31:34', NULL, 'http://visualizar.livros.vc/ebook-35', 0.00, 3, 35),
('ACESSO', '2025-07-16 02:46:25', NULL, 'http://visualizar.livros.vc/ebook-17', 0.00, 1, 17),
('DOWNLOAD', '2025-07-29 02:22:15', 'http://download.livros.vc/ebook-25.pdf', NULL, 55.00, 4, 25),
('ACESSO', '2025-05-29 01:21:50', NULL, 'http://visualizar.livros.vc/ebook-36', 0.00, 1, 36),
('DOWNLOAD', '2025-05-26 14:14:18', 'http://download.livros.vc/ebook-48.pdf', NULL, 45.00, 5, 48),
('ACESSO', '2025-07-16 11:32:44', NULL, 'http://visualizar.livros.vc/ebook-37', 0.00, 3, 37),
('DOWNLOAD', '2025-05-18 23:42:07', 'http://download.livros.vc/ebook-44.pdf', NULL, 40.00, 4, 44),
('ACESSO', '2025-05-23 18:16:32', NULL, 'http://visualizar.livros.vc/ebook-38', 0.00, 4, 38),
('ACESSO', '2025-01-20 03:07:07', NULL, 'http://visualizar.livros.vc/ebook-47', 0.00, 4, 47),
('ACESSO', '2025-06-25 15:06:56', NULL, 'http://visualizar.livros.vc/ebook-38', 0.00, 3, 38),
('DOWNLOAD', '2025-08-11 11:27:14', 'http://download.livros.vc/ebook-25.pdf', NULL, 55.00, 4, 25),
('ACESSO', '2025-02-09 23:38:32', NULL, 'http://visualizar.livros.vc/ebook-43', 0.00, 5, 43),
('DOWNLOAD', '2025-07-29 17:34:03', 'http://download.livros.vc/ebook-30.pdf', NULL, 60.00, 3, 30),
('ACESSO', '2025-05-16 23:09:59', NULL, 'http://visualizar.livros.vc/ebook-33', 0.00, 2, 33),
('ACESSO', '2025-05-18 10:24:28', NULL, 'http://visualizar.livros.vc/ebook-33', 0.00, 4, 33),
('ACESSO', '2025-08-16 19:40:48', NULL, 'http://visualizar.livros.vc/ebook-45', 0.00, 3, 45),
('ACESSO', '2025-06-03 14:00:23', NULL, 'http://visualizar.livros.vc/ebook-15', 0.00, 5, 15),
('ACESSO', '2025-09-02 02:40:24', NULL, 'http://visualizar.livros.vc/ebook-46', 0.00, 3, 46);
